<html>
  <head>
   <title>bailing wire to do</title>
    <style>
      .holder.edit .showMode{
        display: none;
      }
      .holder.show .editMode{
        display: none;
      }
      .selected{
          font-weight: bold;
      }
    </style>
    <script type="text/javascript" src="../src/output.js"></script>
  </head>
  <body>
    <div bw-root="main">
    </div>
    <div template="main">
      <script>
        window.templateScripts = {};
        templateScripts.main = function(scope, template){
	  window.root = scope;
          scope.tasks = [
            {  
              name: "work out",
              text: "pump you up"
            },
            {
	      name: "shots",
	      text: "insulin"
	    }
          ];
          scope.task = scope.tasks[0];
          scope.bindTemplate('.detailHolder', 'detail', {task: 'task', editMode: 'editMode'});
          scope.bindArray('.listHolder', 'listing', {currentTask: 'task'}, 'tasks');
          template.querySelector('button.new').addEventListener('click', function(){
            scope.tasks.push(scope.task = {name: '', text: ''});
	    scope.editMode = true;
          });
      };
      </script>
      <ul class="listHolder"></ul>
      <div class="detailHolder"></div>
      <button class="new">new</button>
    </div>

    <div template="listing">
      <script>
        window.listing = [];
        templateScripts.listing = function(scope, template){
          listing.push(scope);
          scope.bindElement('span', 'innerHTML','$listItem.name');
          template.querySelector('button').addEventListener('click', function(){
            scope.currentTask = scope.$listItem; // specal property provided to array scopes, $listItem
          });
          scope.bindElement('span', 'style.color', function(){
            return scope.currentTask == scope.$listItem ? 'red': 'black';
          });
      };
      </script>
      <button>
        <span></span>
      </button>
    </div>

    <div template="detail">
      <script>
        templateScripts.detail = function(scope, template){
          window.detail = scope;
          scope.bindElement('button', 'innerHTML', function(){
            return scope.editMode ? 'ok': 'edit';
          });
	  template.querySelector('button.toggle').addEventListener('click', function(){
            scope.editMode = !scope.editMode;
	    if(scope.editMode)
	      template.querySelector('input').focus();
          });

          scope.bindElement('.showMode', 'style.visibility', function(){
            return scope.editMode ? 'hidden' : '';
          });
          scope.bindElement('h1', 'innerHTML', 'task.name');
          scope.bindElement('p', 'innerHTML', 'task.text');


          scope.bindElement('.editMode', 'style.visibility', function(){
            return scope.editMode ? '' : 'hidden';
          });
          scope.bindElement('input', 'value', 'task.name');
          scope.bindElement('textarea', 'value', 'task.text');

      };
      </script>
      <button class="toggle"></button>
      <div class="showMode">
        <h1></h1>
        <p></p>
      </div>
      <div class="editMode">
        <input type="text"></input>
        <textarea></textarea>
      </div>
    </div>
  </body
</html>
